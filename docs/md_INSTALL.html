<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libsokoengine: Install</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script
type="text/javascript"
src="doxygen-awesome-darkmode-toggle.js"
></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init();
</script>
<script
type="text/javascript"
src="doxygen-awesome-fragment-copy-button.js"
></script>
<script type="text/javascript">
DoxygenAwesomeFragmentCopyButton.init();
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libsokoengine<span id="projectnumber">&#160;2.0.0.dev</span>
   </div>
  </td>
 </tr>
   <!--BEGIN FULL_SIDEBAR-->
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td></tr>
   <!--END FULL_SIDEBAR-->
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_INSTALL.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Install </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Python package - sokoenginepy</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Install from PyPi</h2>
<div class="fragment"><div class="line">pip install sokoenginepy</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Install from source</h2>
<div class="fragment"><div class="line">python3.9 -m venv .venv</div>
<div class="line">source .venv/bin/activate</div>
<div class="line">pip install -e &quot;.[dev]&quot;</div>
</div><!-- fragment --><p>Running tests:</p>
<div class="fragment"><div class="line">py.test</div>
<div class="line">py.test --spec</div>
</div><!-- fragment --><p>Built-in, rudimentary benchmarks:</p>
<div class="fragment"><div class="line">python -m sokoenginepy</div>
</div><!-- fragment --><p>Local copy of documentation:</p>
<div class="fragment"><div class="line">cd docs/</div>
<div class="line">make html</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
C++ library - libsokoengine</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Build from source</h2>
<ol type="1">
<li>Install C++ compiler, <code>cmake</code> and <code>doxygen</code> (YMMV may vary, depending on your OS):</li>
</ol>
<div class="fragment"><div class="line">sudo apt install git build-essential cmake doxygen graphviz</div>
</div><!-- fragment --><ol type="1">
<li>Install <a href="https://vcpkg.io/">vcpkg</a> and then:</li>
</ol>
<div class="fragment"><div class="line">export CMAKE_TOOLCHAIN_FILE=[vcpkg root]/scripts/buildsystems/vcpkg.cmake</div>
</div><!-- fragment --><ol type="1">
<li>Get <code>libsokoengine</code> sources</li>
</ol>
<div class="fragment"><div class="line">git clone https://github.com/tadams42/sokoenginepy.git</div>
</div><!-- fragment --><ol type="1">
<li>Configure C++ sources</li>
</ol>
<div class="fragment"><div class="line">cd sokoenginepy/</div>
<div class="line">cmake --preset &quot;debug&quot;</div>
</div><!-- fragment --><ol type="1">
<li>Build the library</li>
</ol>
<div class="fragment"><div class="line">cd build/debug</div>
<div class="line">make</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Install from source</h2>
<div class="fragment"><div class="line">cd build/debug</div>
<div class="line">make install</div>
</div><!-- fragment --><p>To later uninstall:</p>
<div class="fragment"><div class="line">xargs rm &lt; install_manifest.txt</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Integrating into other CMake projects</h2>
<p><code>libsokoengine</code> is fully <code>cmake</code> enabled - it exports <code>cmake</code> targets that can be used by other <code>cmake</code> projects:</p>
<div class="fragment"><div class="line">find_package(libsokoengine 1.0.0 REQUIRED)</div>
<div class="line">add_executable(sokoban_app main.cpp)</div>
<div class="line">target_link_libraries(sokoban_app PUBLIC libsokoengine::sokoengine)</div>
</div><!-- fragment --><p>It is also possible to integrate <code>libsokoengine</code> that was built (locally) but not installed. Assuming we have following dir structure:</p>
<div class="fragment"><div class="line">$ tree projects/</div>
<div class="line">projects</div>
<div class="line">├── myapp</div>
<div class="line">│   └── CMakeLists.txt</div>
<div class="line">└── sokoenginepy</div>
<div class="line">    └── CMakeLists.txt</div>
</div><!-- fragment --><p>We first build <code>libsokoengine</code> in <code>projects/sokoenginepy/</code> as described in previous sections. After that, we can use that built library directly from <code>projects/myapp</code> (without running <code>make install</code> in <code>projects/sokoenginepy/</code>).</p>
<p>To do that add following in <code>myapp/CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">set(DEV_PATH_HINT1 &quot;../sokoenginepy/build/debug&quot;)</div>
<div class="line">set(DEV_PATH_HINT2 &quot;../sokoenginepy/build/release&quot;)</div>
<div class="line">cmake_path(ABSOLUTE_PATH DEV_PATH_HINT1 BASE_DIRECTORY ${CMAKE_SOURCE_DIR})</div>
<div class="line">cmake_path(ABSOLUTE_PATH DEV_PATH_HINT2 BASE_DIRECTORY ${CMAKE_SOURCE_DIR})</div>
<div class="line">find_package(</div>
<div class="line">  libsokoengine 1.0.0 REQUIRED</div>
<div class="line">  CONFIG</div>
<div class="line">  PATHS ${DEV_PATH_HINT1}</div>
<div class="line">        ${DEV_PATH_HINT2}</div>
<div class="line">)</div>
</div><!-- fragment --><p>The <code>PATHS</code> argument to <code>find_package</code> serves as a list of hints on where to find requested package.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Other make targets</h2>
<ul>
<li><code>docs</code> - Doxygen documentation</li>
</ul>
<div class="fragment"><div class="line">cd build/debug</div>
<div class="line">make docs</div>
<div class="line">ls docs/libsokoengine-v1.0.1/html/index.html</div>
</div><!-- fragment --><ul>
<li><code>benchmarks</code> - a suite of benchmarks for <code>Mover</code></li>
</ul>
<div class="fragment"><div class="line">make benchmarks</div>
<div class="line">./benchmarks</div>
</div><!-- fragment --><ul>
<li><code>valgrind_profile_playground</code> - a profiling data generator</li>
</ul>
<div class="fragment"><div class="line">sudo apt install kcachegrind valgrind</div>
<div class="line">make valgrind_profile_playground</div>
<div class="line">kcachegrind playground_dump.pid</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Python C++ extension</h1>
<h2><a class="anchor" id="autotoc_md10"></a>
Build using pip</h2>
<p>When installing <code>sokoenginepy</code> from source, <code>pip</code> will try to build native C++ extension. If build fails for whatever reason, <code>pip</code> will fallback to installing pure Python implementation.</p>
<p>If C++ extension is installed, it is utilized automatically: Python code importing and using <code>sokoenginepy</code> package doesn't need to change in any way.</p>
<p>It is possible to circumvent this automatic build via 2 environment variables:</p>
<ul>
<li><code>SOKOENGINEPYEXT_SKIP</code> - if set to true-ish value, C++ extension is not built</li>
<li><code>SOKOENGINEPYEXT_DEBUG</code> - if set to true-ish value, C++ extension compilation produces non optimized binary</li>
</ul>
<p>Prerequisites for <code>pip</code> build of C++ extension:</p>
<ul>
<li>OS is Linux</li>
<li>C++ library build via <code>cmake</code> must've succeed (meaning C++ compiler and <code>vcpkg</code> are correctly set up)</li>
</ul>
<p>When all requirements are met, you can build C++ extension:</p>
<div class="fragment"><div class="line">sudo apt install python3-dev</div>
<div class="line">python3.9 -m venv .venv</div>
<div class="line">source .venv/bin/activate</div>
<div class="line">pip install -e &quot;.[dev]&quot;</div>
</div><!-- fragment --><p>To verify, following file should've been created:</p>
<div class="fragment"><div class="line">src/sokoenginepyext.cpython-XX-YYY_ZZZ-linux-gnu.so</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Build using cmake</h2>
<p>When building through <code>pip</code>, most of the time whole source tree will be recompiled. This is slow and inconvenient for development environments. We can use <code>cmake</code> instead. We still need Python virtual environment though:</p>
<div class="fragment"><div class="line">python3.9 -m venv .venv</div>
<div class="line">source .venv/bin/activate</div>
<div class="line">pip install pybind11</div>
</div><!-- fragment --><p>and then build C++ extension using cmake</p>
<div class="fragment"><div class="line">cd build/debug</div>
<div class="line">make sokoenginepyext</div>
<div class="line">cd ../../src</div>
<div class="line">ln -sf ../build/debug/src/sokoenginepyext/sokoenginepyext.cpython-39-x86_64-linux-gnu.so</div>
<div class="line">cd ..</div>
</div><!-- fragment --><p>After this, we can re-build using just <code>cmake</code> giving us full control:</p>
<div class="fragment"><div class="line">cd build/debug</div>
<div class="line">make sokoenginepyext</div>
</div><!-- fragment --><p>Notice that we don't use <code>vcpkg</code> for <code>pybind11</code> and <code>Python3</code> headers. This is intentional.</p>
<p>C++ extension should be build in requested Python virtual environment. If <code>python</code> was managed via <code>vcpkg</code>, then Python version would've been pinned to whatever <code>vcpkg</code> defines making it impossible to build ie. Python wheels for different Python versions from the same source tree.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Building on windows</h1>
<ol type="1">
<li>Install:<ul>
<li>Visual Studio Community edition for C++ or Microsoft C++ build toolchain</li>
<li>cmake</li>
<li>Python 3</li>
<li>git</li>
</ul>
</li>
<li>open <code>x64 Native Tools Command Prompt</code></li>
<li>setup <code>vcpkg</code></li>
</ol>
<div class="fragment"><div class="line">cd  C:\Users\vagrant\dev</div>
<div class="line">git clone https://github.com/Microsoft/vcpkg.git</div>
<div class="line">cd vcpkg</div>
<div class="line">bootstrap-vcpkg.bat</div>
<div class="line">vcpkg integrate install</div>
<div class="line">set CMAKE_TOOLCHAIN_FILE=C:/Users/vagrant/dev/vcpkg/scripts/buildsystems/vcpkg.cmake</div>
</div><!-- fragment --><ol type="1">
<li>get <code>sokoenginepy</code></li>
</ol>
<div class="fragment"><div class="line">cd  C:\Users\vagrant\dev</div>
<div class="line">git clone https://github.com/tadams42/sokoenginepy.git</div>
<div class="line">cd sokoenginepy</div>
</div><!-- fragment --><p>After that, choose one of following build scenarios:</p>
<ol type="1">
<li>PyPA build...</li>
</ol>
<div class="fragment"><div class="line">set SOKOENGINEPYEXT_SKIP=0</div>
<div class="line">set SOKOENGINEPYEXT_DEBUG=1</div>
<div class="line">python -m venv .venv</div>
<div class="line">.venv\Scripts\activate.bat</div>
<div class="line">python -m pip install --upgrade pip</div>
<div class="line">pip install -U wheel build</div>
<div class="line">python -m build</div>
</div><!-- fragment --><ol type="1">
<li>...or pip build editable</li>
</ol>
<div class="fragment"><div class="line">set SOKOENGINEPYEXT_SKIP=0</div>
<div class="line">set SOKOENGINEPYEXT_DEBUG=1</div>
<div class="line">python -m venv .venv</div>
<div class="line">.venv\Scripts\activate.bat</div>
<div class="line">python -m pip install --upgrade pip</div>
<div class="line">pip install -U wheel</div>
<div class="line"> </div>
<div class="line"># This is curious one - pip is unable to find globally installed cmake; reason unknown</div>
<div class="line"># We need to install cmake directly into Python environment</div>
<div class="line">pip install cmake</div>
<div class="line"> </div>
<div class="line"># and finally</div>
<div class="line">pip install -e .[dev]</div>
</div><!-- fragment --><ol type="1">
<li>...or build directly via cmake for VSCode / Visual Studio</li>
</ol>
<div class="fragment"><div class="line">set CMAKE_TOOLCHAIN_FILE=C:/Users/vagrant/dev/vcpkg/scripts/buildsystems/vcpkg.cmake</div>
<div class="line">python -m venv .venv</div>
<div class="line">.venv\Scripts\activate.bat</div>
<div class="line">python -m pip install --upgrade pip</div>
<div class="line">pip install -U wheel</div>
<div class="line"> </div>
<div class="line">cmake --preset visual_studio</div>
<div class="line"># or</div>
<div class="line"># cmake --preset vscode_win</div>
</div><!-- fragment --><p>Open <code>build/visual_studio</code> or <code>build/vscode_win</code> in appropriate tool and enjoy.</p>
<p>Build from command line:</p>
<div class="fragment"><div class="line">cmake --build build/visual_studio --config Debug --target sokoengine sokoenginepyext</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
